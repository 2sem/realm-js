{"version":3,"file":"TimeoutPromise.js","sourceRoot":"","sources":["TimeoutPromise.ts"],"names":[],"mappings":"AAAA,4EAA4E;AAC5E,EAAE;AACF,4BAA4B;AAC5B,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AACjC,EAAE;AACF,4EAA4E;AAE5E,OAAO,EAAE,YAAY,EAAE,MAAM,UAAU,CAAC;AACxC,OAAO,EAAE,aAAa,EAAE,MAAM,iBAAiB,CAAC;AAOhD,MAAM,OAAO,cAAc;IACjB,KAAK,CAAoB;IACzB,MAAM,GAAG,IAAI,aAAa,EAAK,CAAC;IAExC,YAAY,KAAiB,EAAE,EAAW,EAAE,OAAO,GAAG,UAAU,EAAE,IAAI;QACpE,IAAI,OAAO,EAAE,KAAK,QAAQ,EAAE;YAC1B,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,GAAG,EAAE;gBAC3B,MAAM,GAAG,GAAG,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC;gBACtC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YAC1B,CAAC,EAAE,EAAE,CAAC,CAAC;SACR;QACD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE;YAC/D,IAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;IAED,MAAM;QACJ,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS,EAAE;YAC5B,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACzB,OAAO,IAAI,CAAC,KAAK,CAAC;SACnB;IACH,CAAC;IAED,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAC1D,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAC5D,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAEhE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC;QACtB,OAAO,cAAc,CAAC,IAAI,CAAC;IAC7B,CAAC;CACF","sourcesContent":["////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2022 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n\nimport { TimeoutError } from \"./errors\";\nimport { PromiseHandle } from \"./PromiseHandle\";\n\nexport type TimeoutPromiseOptions = {\n  ms: number;\n  message?: string;\n};\n\nexport class TimeoutPromise<T = unknown> implements Promise<T> {\n  private timer: Timer | undefined;\n  private handle = new PromiseHandle<T>();\n\n  constructor(inner: Promise<T>, ms?: number, message = `Waited ${ms}ms`) {\n    if (typeof ms === \"number\") {\n      this.timer = setTimeout(() => {\n        const err = new TimeoutError(message);\n        this.handle.reject(err);\n      }, ms);\n    }\n    inner.then(this.handle.resolve, this.handle.reject).finally(() => {\n      this.cancel();\n    });\n  }\n\n  cancel() {\n    if (this.timer !== undefined) {\n      clearTimeout(this.timer);\n      delete this.timer;\n    }\n  }\n\n  then = this.handle.promise.then.bind(this.handle.promise);\n  catch = this.handle.promise.catch.bind(this.handle.promise);\n  finally = this.handle.promise.finally.bind(this.handle.promise);\n\n  get [Symbol.toStringTag]() {\n    return TimeoutPromise.name;\n  }\n}\n"]}